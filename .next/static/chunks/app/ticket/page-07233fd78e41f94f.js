(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[699],{9955:(e,s,a)=>{"use strict";a.d(s,{p:()=>l});var t=a(95155);a(12115);var i=a(29602);function l(e){let{className:s,type:a,...l}=e;return(0,t.jsx)("input",{type:a,"data-slot":"input",className:(0,i.cn)("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-12 w-full min-w-0 rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...l})}},14085:(e,s,a)=>{"use strict";a.d(s,{$:()=>o,r:()=>r});var t=a(95155);a(12115);var i=a(12317),l=a(31027),n=a(29602);let r=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-[#0077B6] text-white shadow-xs hover:bg-[#0077B6]/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:s,variant:a,size:l,asChild:o=!1,...d}=e,c=o?i.DX:"button";return(0,t.jsx)(c,{"data-slot":"button",className:(0,n.cn)(r({variant:a,size:l,className:s})),...d})}},19125:(e,s,a)=>{Promise.resolve().then(a.bind(a,70872))},29602:(e,s,a)=>{"use strict";a.d(s,{cn:()=>l});var t=a(43463),i=a(69795);function l(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return(0,i.QP)((0,t.$)(s))}},67401:(e,s,a)=>{"use strict";a.d(s,{A:()=>o});var t=a(12115);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,s=Array(e),a=0;a<e;a++)s[a]=arguments[a];return s.filter((e,s,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===s).join(" ").trim()};var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let r=(0,t.forwardRef)((e,s)=>{let{color:a="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:d="",children:c,iconNode:m,...x}=e;return(0,t.createElement)("svg",{ref:s,...n,width:i,height:i,stroke:a,strokeWidth:o?24*Number(r)/Number(i):r,className:l("lucide",d),...x},[...m.map(e=>{let[s,a]=e;return(0,t.createElement)(s,a)}),...Array.isArray(c)?c:[c]])}),o=(e,s)=>{let a=(0,t.forwardRef)((a,n)=>{let{className:o,...d}=a;return(0,t.createElement)(r,{ref:n,iconNode:s,className:l("lucide-".concat(i(e)),o),...d})});return a.displayName="".concat(e),a}},70872:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>c});var t=a(95155),i=a(12115),l=a(45354),n=a(14085),r=a(9955),o=a(76046);let d=(0,a(67401).A)("BusFront",[["path",{d:"M4 6 2 7",key:"1mqr15"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"m22 7-2-1",key:"1umjhc"}],["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M6 19v2",key:"1loha6"}],["path",{d:"M18 21v-2",key:"sqyl04"}]]),c=()=>{let{isSignedIn:e}=(0,l.Jd)(),s=(0,o.useRouter)(),[a,c]=(0,i.useState)(null),[m,x]=(0,i.useState)([]),[h,u]=(0,i.useState)(null),[p,g]=(0,i.useState)(null),[v,f]=(0,i.useState)(null),[b,j]=(0,i.useState)({name:"",email:"",phone:"",age:"",gender:""});(0,i.useEffect)(()=>{e&&(async()=>{try{let e=await fetch("".concat("http://localhost:5000","/api/ticket"),{method:"GET",credentials:"include"}),s=await e.json();console.log("bus data from backend:",s),s.userData&&(j({name:"".concat(s.userData.firstname," ").concat(s.userData.lastname),email:s.userData.email||"",phone:s.userData.phone.replace(/^\+91\s*/,""),age:s.userData.age||"",gender:s.userData.gender||""}),f(s.userData.gender||"")),e.ok?c(s.bus):console.log("Failed to fetch bus details:",s)}catch(e){console.error("Error fetching bus details:",e)}})()},[e]);let N=e=>{"Booked"!==e.status&&x(s=>s.some(s=>s.seat_no===e.seat_no)?s.filter(s=>s.seat_no!==e.seat_no):[...s,e])},y=async(e,t)=>{if(e.preventDefault(),console.log("\uD83D\uDE80 Schedule ID received in function:",t),!v||!b.age.trim()||!b.email.trim()||!b.name.trim()||!b.phone.trim()){alert("Please fill all fields before submitting.");return}if(!a){alert("Check the details correctly");return}try{let e=m.reduce((e,s)=>e+s.price,0)+20,a=b.phone.startsWith("+")?b.phone:"+91 "+b.phone,[i,...l]=b.name.trim().split(" "),n=l.join(" ")||"",r=await fetch("".concat("http://localhost:5000","/api/bookticket"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({schedule_id:t,seat_id:m,firstname:i,lastname:n,email:b.email,phone:a,age:b.age,gender:b.gender,amount:e})}),o=await r.json();if(console.log("booking data:",o),!r.ok||!(null==o?void 0:o.booking_id))throw Error((null==o?void 0:o.message)||"Booking failed. Please try again.");s.push("/booking-confirmation?booking_id=".concat(o.booking_id))}catch(e){console.log("Error initiating payment:",e),alert("Payment failed. Please try again.")}};return(0,t.jsx)("main",{children:e?(0,t.jsxs)("div",{children:[a?(0,t.jsx)("section",{className:" md:px-6 py-4 gap-2 border-b",children:(0,t.jsxs)("div",{className:"border rounded flex flex-col gap-6 py-2 px-4 ",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{children:a.name}),(0,t.jsx)("h3",{children:"Boarding Points"}),a.boarding_points.length>0?(0,t.jsx)("ul",{children:a.boarding_points.map((e,s)=>(0,t.jsxs)("li",{className:"flex gap-1 mt-1 items-center",onClick:()=>u(e),style:{cursor:"pointer",fontWeight:(null==h?void 0:h.location_name)===e.location_name?"bold":"normal",color:(null==h?void 0:h.location_name)===e.location_name?"#f5f5f5":"#a3a3a3"},children:[(0,t.jsx)(d,{className:"w-4 h-4"}),(0,t.jsxs)("div",{children:[e.location_name," - ",e.time.slice(0,5)]})]},s))}):(0,t.jsx)("p",{children:"You will be notified for boarding."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{children:"Dropping Points"}),a.dropping_points.length>0?(0,t.jsx)("ul",{children:a.dropping_points.map((e,s)=>(0,t.jsxs)("li",{className:"flex gap-1 mt-1 items-center",onClick:()=>g(e),style:{cursor:"pointer",fontWeight:(null==p?void 0:p.location_name)===e.location_name?"bold":"normal",color:(null==p?void 0:p.location_name)===e.location_name?"#f5f5f5":"#a3a3a3"},children:[(0,t.jsx)(d,{className:"w-4 h-4"})," ",(0,t.jsxs)("div",{children:[e.location_name," - ",e.time.slice(0,5)]})]},s))}):(0,t.jsx)("p",{children:"You will be notified for dropping."})]})]}),(0,t.jsxs)("div",{className:"px-4 py-4 rounded border shadow-lg  mx-auto",children:[(0,t.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-gray-400 rounded"}),(0,t.jsx)("div",{children:"Booked"})]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-[#28A745] rounded"}),(0,t.jsx)("div",{children:"Available"})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-4 p-2",children:(null==a?void 0:a.available_seats)&&a.available_seats.length>0?a.available_seats.map(e=>(0,t.jsxs)("button",{className:"w-[4rem] h-[3.5rem] flex flex-col items-center justify-center text-sm font-semibold border-2 rounded-lg \n          ".concat("Booked"===e.status?"bg-gray-400 text-white cursor-not-allowed":m.some(s=>s.seat_no===e.seat_no)?"bg-blue-500 text-white":"bg-[#28A745] text-white hover:bg-green-600"),disabled:"Booked"===e.status,onClick:()=>"Booked"!==e.status&&N(e),children:[(0,t.jsx)("span",{className:"font-bold",children:e.seat_no}),(0,t.jsx)("span",{className:"text-xs",children:e.seat_type})]},e.seat_no)):(0,t.jsx)("p",{className:"text-gray-500 text-center w-full",children:"Fetching seats..."})}),(0,t.jsxs)("div",{className:"flex justify-between mt-6 p-2 border-t",children:[(0,t.jsxs)("div",{children:["Seats Selected:"," ",(0,t.jsx)("span",{className:"text-xl font-semibold",children:m.length>0?m.map(e=>e.seat_no).join(", "):"None"})]}),(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"text-xl font-semibold",children:["â‚¹"," ",m.reduce((e,s)=>e+s.price,0)]})})]})]})]})}):(0,t.jsx)("p",{children:"Loading route details...."}),a?(0,t.jsx)("section",{className:"flex flex-col items-center justify-center py-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,t.jsx)("div",{className:"text-2xl font-semibold",children:"Review your booking"}),(0,t.jsxs)("div",{className:"text-xl font-medium",children:[" ",(0,t.jsxs)("span",{className:"font-semibold mr-1",children:[a.source," - ",a.destination," "]})," ","|"," ",new Date(a.departure_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,t.jsx)("div",{className:"md:w-[60%]",children:(0,t.jsxs)("div",{className:"border rounded px-4 pt-2 pb-6",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xl font-semibold",children:a.bus_name}),(0,t.jsx)("div",{className:"text-sm",children:a.bus_type}),(0,t.jsxs)("div",{className:"my-2",children:["Seat selected"," ",(0,t.jsx)("span",{className:"text-xl font-semibold",children:m.length>0?m.map(e=>e.seat_no).join(", "):"None"})]})]}),(0,t.jsx)("div",{className:"text-[#0077B6]",children:"Cancellation Policy"})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-2",children:[(0,t.jsxs)("div",{className:"border px-2 py-2 rounded flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-xl",children:"Boarding Point"}),(0,t.jsxs)("div",{className:"bg-[#0077B6] text-white px-2 rounded  text-sm",children:[h?"".concat(h.time.slice(0,5)," "):"None"," ",new Date(a.departure_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,t.jsx)("div",{className:"text-lg mt-2",children:h?"".concat(h.location_name):"None"})]}),(0,t.jsxs)("div",{className:"border px-2 py-2 rounded flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"text-xl",children:"Dropping Point"}),(0,t.jsxs)("div",{className:"bg-[#0077B6] text-white px-2 rounded text-sm",children:[p?"".concat(p.time.slice(0,5)," "):"None"," ",new Date(a.arrival_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,t.jsx)("div",{className:"text-lg mt-2",children:p?"".concat(p.location_name," "):"None"})]})]})]})}),(0,t.jsxs)("div",{className:"border rounded md:w-[40%] flex flex-col gap-2 px-4 py-2",children:[(0,t.jsx)("div",{className:"text-2xl font-semibold",children:"Price Details"}),(0,t.jsxs)("div",{className:"border-b py-1",children:[(0,t.jsxs)("div",{children:["Base Fare :"," ",(0,t.jsxs)("span",{className:"text-xl mx-2 font-semibold",children:["â‚¹"," ",m.reduce((e,s)=>e+s.price,0)]})]}),(0,t.jsxs)("div",{children:["GST & Exlcusive tax :"," ",(0,t.jsx)("span",{className:"text-xl mx-2 font-semibold",children:"â‚¹ 20"})]})]}),(0,t.jsxs)("div",{className:"text-lg font-semibold",children:["Total :"," ",(0,t.jsxs)("span",{className:"text-xl mx-2 font-semibold",children:["â‚¹"," ",m.reduce((e,s)=>e+s.price,0)+20]})]})]})]}),(0,t.jsxs)("div",{className:"border rounded p-4 mt-4",children:[(0,t.jsx)("div",{className:"text-2xl",children:"Passenger Details"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-10 gap-4 mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mx-1",children:"Full Name"}),(0,t.jsx)(r.p,{type:"text",value:b.name,onChange:e=>j({...b,name:e.target.value}),className:"h-10 mt-2 ",placeholder:"Enter your name"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mx-1",children:"Age"}),(0,t.jsx)(r.p,{className:"h-10 mt-2",placeholder:"Age",type:"text",value:b.age,onChange:e=>j({...b,age:e.target.value})})]}),(0,t.jsxs)("div",{className:"mx-1",children:[(0,t.jsx)("div",{children:"Gender"}),(0,t.jsx)("div",{className:"flex gap-2 mt-2",children:["Male","Female"].map(e=>(0,t.jsx)(n.$,{variant:v===e?"destructive":"secondary",onClick:()=>{f(e),j(s=>({...s,gender:e}))},className:"px-4 py-2 rounded-md transition-all ".concat(v===e?"":"border"),children:e},e))})]})]})]}),(0,t.jsxs)("div",{className:"border rounded p-4 mt-4",children:[(0,t.jsx)("div",{className:"text-2xl",children:"Contact Details"}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-10 gap-4 mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mx-1",children:"Email"}),(0,t.jsx)(r.p,{className:"h-10 mt-2 ",placeholder:"Enter your email",type:"email",value:b.email,onChange:e=>j({...b,email:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"mx-1",children:"Mobile Number"}),(0,t.jsx)(r.p,{className:"h-10 mt-2 ",placeholder:"Enter your number",type:"text",value:b.phone,onChange:e=>j({...b,phone:e.target.value})})]})]})]}),(0,t.jsxs)(n.$,{onClick:e=>y(e,a.schedule_id),className:"w-full text-xl bg-[#FF6F00] hover:bg-[#FF6F00] text-white cursor-pointer font-semibold h-12 mt-4",children:["Continue to Payment â‚¹"," ",m.reduce((e,s)=>e+s.price,0)+20]})]})}):(0,t.jsx)("p",{children:"Loading ticket details...."})]}):(0,t.jsx)(l.hZ,{mode:"modal"})})}}},e=>{var s=s=>e(e.s=s);e.O(0,[354,2,441,587,358],()=>s(19125)),_N_E=e.O()}]);