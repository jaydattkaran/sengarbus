(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{8924:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var a=t(95155),i=t(14085),l=t(12115),r=t(76046);let n=(0,t(67401).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var d=t(45354);let c=()=>{var e;let{isSignedIn:s}=(0,d.Jd)(),t=(0,r.useSearchParams)(),c=(0,r.useRouter)(),[o]=(0,l.useState)(t.get("source")||""),[x]=(0,l.useState)(t.get("destination")||""),[u,m]=(0,l.useState)([]),[h,v]=(0,l.useState)(!0),p=t.get("date")?new Date(t.get("date")):null,[f]=(0,l.useState)(p),g=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),b=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),j=u.map(e=>({...e,formattedDeparture:g(e.departure_time),formattedArrival:g(e.arrival_time)}));if((0,l.useEffect)(()=>{o&&x&&f&&(async()=>{try{var e;v(!0);let s=await fetch("".concat("http://localhost:5000","/api/search-buses"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({source:o,destination:x,travelDate:f?f.toISOString().split("T")[0]:null})});if(!s.ok)throw Error("Failed to fetch buses");let t=await s.json();console.log("Available buses:",t);let a=(null===(e=t.buses)||void 0===e?void 0:e.map(e=>{let s=e.available_seats||[];return{...e,totalAvailableSeats:s.filter(e=>"Available"===e.status).length,lowestPrice:s.length>0?Math.min(...s.map(e=>+e.price)):null}}))||[];m(a)}catch(e){console.log("Error fetching buses:",e)}finally{v(!1)}})()},[o,x,f]),h)return(0,a.jsx)("p",{children:"Loading buses..."});let y=async e=>{if(e.isFullyBooked){alert("This bus is fully booked.");return}try{if(!s){alert("Please sign in to continue booking.");return}let t=await fetch("".concat("http://localhost:5000","/api/buses/select"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bus:e})});if(t.ok){let s=await t.json();console.log("bus details for booking",s),c.push("/ticket?busId=".concat(e.bus_id,"&routeId=").concat(e.route_id))}else alert("Bus not selected.")}catch(e){console.log("Error selecting bus:",e),alert("An error occurred. Please try again.")}};return(0,a.jsx)("main",{children:(0,a.jsx)("section",{className:"py-4",children:(0,a.jsx)("div",{className:"p-2",children:(0,a.jsxs)("section",{className:"py-4 md:mx-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-xl px-2",children:["Buses from ",o," to ",x," on"," ",null===(e=j[0])||void 0===e?void 0:e.formattedDeparture]}),(0,a.jsx)("ul",{className:"py-2 mt-4 px-1 flex flex-col gap-4 md:hidden block",children:Array.isArray(u)&&u.length>0?u.map(e=>(0,a.jsx)("li",{onClick:()=>y(e),className:"cursor-pointer",children:(0,a.jsxs)("div",{className:"w-[95vw] rounded glass-box border grid md:grid-cols-3 md:gap-1 gap-2 p-1 py-2",children:[(0,a.jsxs)("div",{className:"px-2 flex md:flex-col flex-row justify-between items-center md:gap-4 gap-20",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xl font-semibold",children:e.bus_name}),(0,a.jsx)("div",{className:"text-neutral-400 text-sm",children:e.bus_type})]}),(0,a.jsx)("div",{children:"4.0/5"})]}),(0,a.jsxs)("div",{className:"flex justify-between pb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between gap-2 px-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"text-xl font-semibold",children:b(e.departure_time)})}),(0,a.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,a.jsxs)("div",{className:"text-neutral-300",children:["- ",e.distance_km," km -"]})}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"text-xl font-semibold",children:b(e.arrival_time)})})]}),(0,a.jsxs)("div",{className:"px-2 text-sm text-gray-400 flex gap-1",children:[(0,a.jsx)(n,{className:"w-4 h-4"})," ",(0,a.jsxs)("div",{className:"items-center",children:[e.totalAvailableSeats," Seats"]})]})]}),(0,a.jsx)("div",{className:"flex md:flex-col justify-between items-end gap-2 pr-2 md:px-0 px-2",children:(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"text-xl font-semibold",children:null!==e.lowestPrice&&(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["₹ ",e.lowestPrice]})})})})]})]})},e.schedule_id)):(0,a.jsx)("p",{children:"No buses available"})})]}),(0,a.jsx)("div",{children:(0,a.jsx)("ul",{className:"py-2 mt-4 px-1 flex flex-col gap-4 hidden md:block",children:Array.isArray(u)&&u.length>0?u.map(e=>{var s,t;return(0,a.jsx)("li",{children:(0,a.jsxs)("div",{className:"w-full mt-4 rounded glass-box border flex justify-between gap-2 px-2 py-4",children:[(0,a.jsxs)("div",{className:"flex flex-col justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xl font-semibold",children:e.bus_name}),(0,a.jsx)("div",{className:"text-neutral-400 text-sm",children:e.bus_type})]}),(0,a.jsx)("div",{children:"4.0/5"})]}),(0,a.jsxs)("div",{className:"flex justify-between gap-2 min-w-[18vw]",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm",children:g(e.departure_time)}),(0,a.jsx)("div",{className:"text-xl font-semibold",children:b(e.departure_time)}),(0,a.jsx)("div",{className:"text-sm w-[7rem]",children:(null===(s=e.boarding_points)||void 0===s?void 0:s.length)>0?(0,a.jsx)("p",{children:e.boarding_points[0].location_name}):(0,a.jsx)("p",{children:"Not available"})})]}),(0,a.jsxs)("div",{className:"flex flex-col items-center pr-4",children:[(0,a.jsxs)("div",{className:"text-neutral-300",children:[e.distance_km," km"]}),(0,a.jsx)("div",{className:"relative flex items-center",children:(0,a.jsxs)("div",{className:"w-[5rem] h-1 bg-neutral-400 relative",children:[(0,a.jsx)("span",{className:"absolute -left-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-neutral-400 rounded-full"}),(0,a.jsx)("span",{className:"absolute -right-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-neutral-400 rounded-full"})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm",children:g(e.arrival_time)}),(0,a.jsx)("div",{className:"text-xl font-semibold",children:b(e.arrival_time)}),(0,a.jsx)("div",{className:"text-sm w-[7rem]",children:(null===(t=e.dropping_points)||void 0===t?void 0:t.length)>0?(0,a.jsx)("p",{children:e.dropping_points[0].location_name}):(0,a.jsx)("p",{children:"Not available"})})]})]}),(0,a.jsxs)("div",{className:"flex md:flex-col  justify-between items-end gap-2",children:[(0,a.jsx)("div",{children:null!==e.lowestPrice&&(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["₹ ",e.lowestPrice]})}),(0,a.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,a.jsxs)("div",{className:"text-neutral-400 text-sm",children:[e.totalAvailableSeats," Seats"]}),(0,a.jsx)(i.$,{onClick:()=>y(e),className:"uppercase cursor-pointer text-lg w-[11rem] text-white font-semibold bg-[#FF6F00] hover:bg-[#FF6F00]",children:"Select Seat"})]})]})]})},e.schedule_id)}):(0,a.jsx)("p",{children:"No buses available"})})})]})})})})}},14085:(e,s,t)=>{"use strict";t.d(s,{$:()=>d,r:()=>n});var a=t(95155);t(12115);var i=t(12317),l=t(31027),r=t(29602);let n=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-[#0077B6] text-white shadow-xs hover:bg-[#0077B6]/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:s,variant:t,size:l,asChild:d=!1,...c}=e,o=d?i.DX:"button";return(0,a.jsx)(o,{"data-slot":"button",className:(0,r.cn)(n({variant:t,size:l,className:s})),...c})}},23197:(e,s,t)=>{Promise.resolve().then(t.bind(t,8924))},29602:(e,s,t)=>{"use strict";t.d(s,{cn:()=>l});var a=t(43463),i=t(69795);function l(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,i.QP)((0,a.$)(s))}},67401:(e,s,t)=>{"use strict";t.d(s,{A:()=>d});var a=t(12115);let i=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()};var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,a.forwardRef)((e,s)=>{let{color:t="currentColor",size:i=24,strokeWidth:n=2,absoluteStrokeWidth:d,className:c="",children:o,iconNode:x,...u}=e;return(0,a.createElement)("svg",{ref:s,...r,width:i,height:i,stroke:t,strokeWidth:d?24*Number(n)/Number(i):n,className:l("lucide",c),...u},[...x.map(e=>{let[s,t]=e;return(0,a.createElement)(s,t)}),...Array.isArray(o)?o:[o]])}),d=(e,s)=>{let t=(0,a.forwardRef)((t,r)=>{let{className:d,...c}=t;return(0,a.createElement)(n,{ref:r,iconNode:s,className:l("lucide-".concat(i(e)),d),...c})});return t.displayName="".concat(e),t}}},e=>{var s=s=>e(e.s=s);e.O(0,[354,2,441,587,358],()=>s(23197)),_N_E=e.O()}]);