(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{8924:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(95155),a=t(14085),i=t(12115),l=t(76046);let n=(0,t(67401).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var d=t(45354),o=t(19173);let c=()=>{var e;let{isSignedIn:s}=(0,d.Jd)(),{getToken:t}=(0,o.d)(),c=(0,l.useSearchParams)(),u=(0,l.useRouter)(),[x]=(0,i.useState)(c.get("source")||""),[m]=(0,i.useState)(c.get("destination")||""),[h,v]=(0,i.useState)([]),[p,f]=(0,i.useState)(!0),g=c.get("date")?new Date(c.get("date")):null,[b]=(0,i.useState)(g),j=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),y=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),N=h.map(e=>({...e,formattedDeparture:j(e.departure_time),formattedArrival:j(e.arrival_time)}));if((0,i.useEffect)(()=>{x&&m&&b&&(async()=>{try{var e;f(!0);let s=await fetch("".concat("https://sengarbus.onrender.com","/api/search-buses"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({source:x,destination:m,travelDate:b?b.toISOString().split("T")[0]:null})});if(!s.ok)throw Error("Failed to fetch buses");let t=await s.json();console.log("Available buses:",t);let r=(null===(e=t.buses)||void 0===e?void 0:e.map(e=>{let s=e.available_seats||[];return{...e,totalAvailableSeats:s.filter(e=>"Available"===e.status).length,lowestPrice:s.length>0?Math.min(...s.map(e=>+e.price)):null}}))||[];v(r)}catch(e){console.log("Error fetching buses:",e)}finally{f(!1)}})()},[x,m,b]),p)return(0,r.jsx)("p",{children:"Loading buses..."});let w=async e=>{if(e.isFullyBooked){alert("This bus is fully booked.");return}if(!s){alert("Please sign in to continue booking.");return}try{let s=await t();if(!s){alert("Authentication error: Could not retrieve token.");return}let r=await fetch("".concat("https://sengarbus.onrender.com","/api/buses/select"),{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bus:e})}),a=await r.json();console.log("API Response:",r.status,a),r.ok?(console.log("Bus details for booking",a),u.push("/ticket?busId=".concat(e.bus_id,"&routeId=").concat(e.route_id))):alert("Bus not selected. Server response: ".concat(a.message||"Unknown error"))}catch(e){console.log("Error selecting bus:",e),alert("An error occurred. Please try again.")}};return(0,r.jsx)("main",{children:(0,r.jsx)("section",{className:"py-4",children:(0,r.jsx)("div",{className:"p-2",children:(0,r.jsxs)("section",{className:"py-4 md:mx-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-xl px-2",children:["Buses from ",x," to ",m," on"," ",null===(e=N[0])||void 0===e?void 0:e.formattedDeparture]}),(0,r.jsx)("ul",{className:"py-2 mt-4 px-1 flex flex-col gap-4 md:hidden block",children:Array.isArray(h)&&h.length>0?h.map(e=>(0,r.jsx)("li",{onClick:()=>w(e),className:"cursor-pointer",children:(0,r.jsxs)("div",{className:"w-[95vw] rounded glass-box border grid md:grid-cols-3 md:gap-1 gap-2 p-1 py-2",children:[(0,r.jsxs)("div",{className:"px-2 flex md:flex-col flex-row justify-between items-center md:gap-4 gap-20",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xl font-semibold",children:e.bus_name}),(0,r.jsx)("div",{className:"text-neutral-400 text-sm",children:e.bus_type})]}),(0,r.jsx)("div",{children:"4.0/5"})]}),(0,r.jsxs)("div",{className:"flex justify-between pb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between gap-2 px-2",children:[(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-xl font-semibold",children:y(e.departure_time)})}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,r.jsxs)("div",{className:"text-neutral-300",children:["- ",e.distance_km," km -"]})}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-xl font-semibold",children:y(e.arrival_time)})})]}),(0,r.jsxs)("div",{className:"px-2 text-sm text-gray-400 flex gap-1",children:[(0,r.jsx)(n,{className:"w-4 h-4"})," ",(0,r.jsxs)("div",{className:"items-center",children:[e.totalAvailableSeats," Seats"]})]})]}),(0,r.jsx)("div",{className:"flex md:flex-col justify-between items-end gap-2 pr-2 md:px-0 px-2",children:(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-xl font-semibold",children:null!==e.lowestPrice&&(0,r.jsxs)("div",{className:"text-xl font-semibold",children:["₹ ",e.lowestPrice]})})})})]})]})},e.schedule_id)):(0,r.jsx)("p",{children:"No buses available"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)("ul",{className:"py-2 mt-4 px-1 flex flex-col gap-4 hidden md:block",children:Array.isArray(h)&&h.length>0?h.map(e=>{var s,t;return(0,r.jsx)("li",{children:(0,r.jsxs)("div",{className:"w-full mt-4 rounded glass-box border flex justify-between gap-2 px-2 py-4",children:[(0,r.jsxs)("div",{className:"flex flex-col justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xl font-semibold",children:e.bus_name}),(0,r.jsx)("div",{className:"text-neutral-400 text-sm",children:e.bus_type})]}),(0,r.jsx)("div",{children:"4.0/5"})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-2 min-w-[18vw]",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:j(e.departure_time)}),(0,r.jsx)("div",{className:"text-xl font-semibold",children:y(e.departure_time)}),(0,r.jsx)("div",{className:"text-sm w-[7rem]",children:(null===(s=e.boarding_points)||void 0===s?void 0:s.length)>0?(0,r.jsx)("p",{children:e.boarding_points[0].location_name}):(0,r.jsx)("p",{children:"Not available"})})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center pr-4",children:[(0,r.jsxs)("div",{className:"text-neutral-300",children:[e.distance_km," km"]}),(0,r.jsx)("div",{className:"relative flex items-center",children:(0,r.jsxs)("div",{className:"w-[5rem] h-1 bg-neutral-400 relative",children:[(0,r.jsx)("span",{className:"absolute -left-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-neutral-400 rounded-full"}),(0,r.jsx)("span",{className:"absolute -right-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-neutral-400 rounded-full"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:j(e.arrival_time)}),(0,r.jsx)("div",{className:"text-xl font-semibold",children:y(e.arrival_time)}),(0,r.jsx)("div",{className:"text-sm w-[7rem]",children:(null===(t=e.dropping_points)||void 0===t?void 0:t.length)>0?(0,r.jsx)("p",{children:e.dropping_points[0].location_name}):(0,r.jsx)("p",{children:"Not available"})})]})]}),(0,r.jsxs)("div",{className:"flex md:flex-col  justify-between items-end gap-2",children:[(0,r.jsx)("div",{children:null!==e.lowestPrice&&(0,r.jsxs)("div",{className:"text-xl font-semibold",children:["₹ ",e.lowestPrice]})}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,r.jsxs)("div",{className:"text-neutral-400 text-sm",children:[e.totalAvailableSeats," Seats"]}),(0,r.jsx)(a.$,{onClick:()=>w(e),className:"uppercase cursor-pointer text-lg w-[11rem] text-white font-semibold bg-[#FF6F00] hover:bg-[#FF6F00]",children:"Select Seat"})]})]})]})},e.schedule_id)}):(0,r.jsx)("p",{children:"No buses available"})})})]})})})})}},14085:(e,s,t)=>{"use strict";t.d(s,{$:()=>d,r:()=>n});var r=t(95155);t(12115);var a=t(12317),i=t(31027),l=t(29602);let n=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-[#0077B6] text-white shadow-xs hover:bg-[#0077B6]/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:s,variant:t,size:i,asChild:d=!1,...o}=e,c=d?a.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,l.cn)(n({variant:t,size:i,className:s})),...o})}},23197:(e,s,t)=>{Promise.resolve().then(t.bind(t,8924))},29602:(e,s,t)=>{"use strict";t.d(s,{cn:()=>i});var r=t(43463),a=t(69795);function i(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.QP)((0,r.$)(s))}},67401:(e,s,t)=>{"use strict";t.d(s,{A:()=>d});var r=t(12115);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,r.forwardRef)((e,s)=>{let{color:t="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:d,className:o="",children:c,iconNode:u,...x}=e;return(0,r.createElement)("svg",{ref:s,...l,width:a,height:a,stroke:t,strokeWidth:d?24*Number(n)/Number(a):n,className:i("lucide",o),...x},[...u.map(e=>{let[s,t]=e;return(0,r.createElement)(s,t)}),...Array.isArray(c)?c:[c]])}),d=(e,s)=>{let t=(0,r.forwardRef)((t,l)=>{let{className:d,...o}=t;return(0,r.createElement)(n,{ref:l,iconNode:s,className:i("lucide-".concat(a(e)),d),...o})});return t.displayName="".concat(e),t}}},e=>{var s=s=>e(e.s=s);e.O(0,[173,2,441,587,358],()=>s(23197)),_N_E=e.O()}]);