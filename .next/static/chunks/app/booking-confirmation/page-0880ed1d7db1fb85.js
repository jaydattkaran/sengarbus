(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[792],{11692:(e,t,s)=>{Promise.resolve().then(s.bind(s,33690))},14085:(e,t,s)=>{"use strict";s.d(t,{$:()=>d,r:()=>o});var n=s(95155);s(12115);var i=s(12317),r=s(31027),a=s(29602);let o=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-[#0077B6] text-white shadow-xs hover:bg-[#0077B6]/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:s,size:r,asChild:d=!1,...l}=e,c=d?i.DX:"button";return(0,n.jsx)(c,{"data-slot":"button",className:(0,a.cn)(o({variant:s,size:r,className:t})),...l})}},29602:(e,t,s)=>{"use strict";s.d(t,{cn:()=>r});var n=s(43463),i=s(69795);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,n.$)(t))}},33690:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var n=s(95155),i=s(12115),r=s(76046),a=s(10142),o=s(40078),d=s.n(o),l=s(14085);let c=()=>{let[e,t]=(0,i.useState)(null),[s,o]=(0,i.useState)(null),[c,x]=(0,i.useState)(!1),m=(0,r.useRouter)(),p=(0,r.useSearchParams)().get("booking_id"),g=(0,i.useRef)(null);(0,i.useEffect)(()=>{p&&h(p)},[p]),(0,i.useEffect)(()=>{if(e&&(null==e?void 0:e.payment_status)==="success"){let e=120;o(120);let t=setInterval(()=>{o(e-=1),e<=0&&(clearInterval(t),m.push("/"))},1e3);return()=>clearInterval(t)}},[e,m]);let h=async e=>{try{let s=await fetch("".concat("http://localhost:5000","/api/bookedticket/?booking_id=").concat(e),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!s.ok)throw Error("Error: ".concat(s.status," - ").concat(s.statusText));let n=await s.json();console.log("booked tickets:",n),n.booked_at||console.error("⚠️ booked_at is missing from API response!"),t(n)}catch(e){console.error("Error fetching booking details:",e)}},u=()=>{if(!e)return null;let t=e=>new Date(e).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}),s=document.createElement("div");s.id="pdf-ticket-container",s.style.width="600px",s.style.padding="0",s.style.margin="0",s.style.backgroundColor="#ffffff",s.style.fontFamily="Arial, sans-serif",s.style.color="#333333",s.style.border="1px solid #dddddd",s.style.borderRadius="8px",s.style.overflow="hidden",s.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)";let n=document.createElement("div");n.style.backgroundColor="#2563eb",n.style.color="#ffffff",n.style.padding="20px",n.innerHTML='\n      <div style="display: flex; justify-content: space-between; align-items: center;">\n        <div>\n          <h2 style="margin: 0; font-size: 24px; font-weight: bold;">SengarBus</h2>\n          <p style="margin: 4px 0 0; font-size: 14px; color: #e6f0ff;">E-Ticket Confirmation</p>\n        </div>\n        <div style="background-color: #ffffff; color: #2563eb; border-radius: 50%; padding: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">\n          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />\n          </svg>\n        </div>\n      </div>\n    ',s.appendChild(n);let i=document.createElement("div");i.style.padding="16px 20px",i.style.borderBottom="1px solid #dddddd",i.style.backgroundColor="#f9fafb";let r='\n      <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">\n        <div style="margin-bottom: 8px; min-width: 120px;">\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Booking Reference</div>\n          <div style="font-size: 18px; font-weight: bold; color: #1f2937;">#'.concat(e.booking_id,'</div>\n        </div>\n        <div style="margin-bottom: 8px; min-width: 120px;">\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Status</div>\n          <div style="display: inline-block; padding: 4px 0; font-size: 14px; font-weight: 600; border-radius: 9999px;  color: #166534;">\n            ').concat(e.payment_status,'\n          </div>\n        </div>\n        <div style="min-width: 120px;">\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Booked On</div>\n          <div style="font-size: 14px; color: #1f2937;">').concat(new Date(e.booked_at).toLocaleDateString(),"</div>\n        </div>\n      </div>\n    ");i.innerHTML=r,s.appendChild(i);let a=document.createElement("div");a.style.padding="20px",a.style.borderBottom="1px solid #dddddd";let o='\n      <h3 style="font-size: 18px; font-weight: 600; color: #1f2937; margin-top: 0; margin-bottom: 16px;">Passenger Details</h3>\n      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">\n        <div>\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Name</div>\n          <div style="color: #1f2937;">'.concat(e.user.firstname," ").concat(e.user.lastname,'</div>\n        </div>\n        <div>\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Contact</div>\n          <div style="color: #1f2937;">').concat(e.user.phone,'</div>\n        </div>\n        <div style="grid-column: span 2;">\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Email</div>\n          <div style="color: #1f2937;">').concat(e.user.email,"</div>\n        </div>\n      </div>\n    ");a.innerHTML=o,s.appendChild(a);let d=document.createElement("div");d.style.padding="20px",d.style.borderBottom="1px solid #dddddd";let l='\n      <h3 style="font-size: 18px; font-weight: 600; color: #1f2937; margin-top: 0; margin-bottom: 16px;">Journey Details</h3>\n      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">\n        <div>\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Departure</div>\n          <div style="color: #1f2937; font-weight: 500;">'.concat(e.schedule.route.source,'</div>\n          <div style="color: #1f2937; font-weight: 500;">').concat(t(e.schedule.departure_time),'</div>\n        </div>\n        <div style="text-align: center;">\n          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#9ca3af">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />\n          </svg>\n        </div>\n        <div>\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Arrival</div>\n          <div style="color: #1f2937; font-weight: 500;">').concat(e.schedule.route.destination,'</div>\n          <div style="color: #1f2937; font-weight: 500;">').concat(t(e.schedule.arrival_time),"</div>\n        </div>\n      </div>\n    ");d.innerHTML=l,s.appendChild(d);let c=document.createElement("div");c.style.padding="20px",c.style.borderBottom="1px solid #dddddd";let x='\n      <h3 style="font-size: 18px; font-weight: 600; color: #1f2937; margin-top: 0; margin-bottom: 16px;">Seat Details</h3>\n      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">\n    ';e.seats.forEach(e=>{x+='\n        <div style="background-color: #eff6ff; border-radius: 8px; padding: 12px; border: 1px solid #dbeafe;">\n          <div style="font-size: 12px; text-transform: uppercase; color: #2563eb; font-weight: 600;">Seat '.concat(e.seat_no,'</div>\n          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">\n            <span style="color: #1f2937;">').concat(e.seat_type,'</span>\n            <span style="font-weight: bold; color: #111827;">₹').concat(e.price,"</span>\n          </div>\n        </div>\n      ")}),x+="</div>",c.innerHTML=x,s.appendChild(c);let m=document.createElement("div");m.style.padding="20px",m.style.backgroundColor="#f9fafb";let p='\n      <div style="display: flex; justify-content: space-between; align-items: center;">\n        <div>\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Total Amount</div>\n          <div style="font-size: 24px; font-weight: bold; color: #1f2937;">₹'.concat(e.amount,'</div>\n        </div>\n        <div style="text-align: right;">\n          <div style="font-size: 12px; text-transform: uppercase; color: #6b7280; font-weight: 600;">Payment Status</div>\n          <div style="color: #059669; font-weight: 500;">').concat(e.payment_status,"</div>\n        </div>\n      </div>\n    ");m.innerHTML=p,s.appendChild(m);let g=document.createElement("div");return g.style.backgroundColor="#f3f4f6",g.style.padding="16px 20px",g.style.textAlign="center",g.innerHTML='\n      <p style="color: #4b5563; font-size: 14px; margin: 0 0 4px 0;">Thank you for choosing SengarBus! We wish you a safe and comfortable journey.</p>\n      <p style="color: #6b7280; font-size: 12px; margin: 0;">Have questions? Contact our support at support@sengarbus.com</p>\n    ',s.appendChild(g),s},f=async()=>{x(!0);try{let t=u();if(!t)return;document.body.appendChild(t);let s=await d()(t,{scale:2,useCORS:!0,backgroundColor:"#ffffff",logging:!1});document.body.removeChild(t);let n=s.toDataURL("image/png",1),i=new a.Ay({orientation:"portrait",unit:"mm",format:"a4"}),r=i.internal.pageSize.getWidth(),o=i.internal.pageSize.getHeight(),l=r-30,c=s.height*l/s.width;i.addImage(n,"PNG",15,(o-c)/2,l,c),i.setFontSize(8),i.setTextColor(120,120,120),i.text("Generated on "+new Date().toLocaleString(),15,o-10),i.save("SengarBus-Ticket-".concat(null==e?void 0:e.booking_id,".pdf"))}catch(e){console.error("Error generating PDF:",e),alert("There was an error generating the PDF. Please try again.")}finally{x(!1)}},v=e=>{if(console.log("Received dateString:",e),!e)return"N/A";let t=new Date(e);return isNaN(t.getTime())?(console.error("Invalid date:",e),"Invalid Date"):new Intl.DateTimeFormat("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:"Asia/Kolkata"}).format(t)};return e?(0,n.jsxs)("div",{className:"min-h-screen py-4 px-4 sm:px-6 lg:px-8 flex flex-col items-center",children:[(0,n.jsx)("div",{children:"success"===e.payment_status&&null!==s&&(0,n.jsxs)("p",{className:"text-lg mb-4 text-neutral-300",children:["Redirecting to homepage in ",s," seconds..."]})}),(0,n.jsx)("div",{className:"w-full max-w-2xl mx-auto mb-8",children:(0,n.jsxs)("div",{ref:g,className:"ticket-container bg-white rounded-lg overflow-hidden shadow-lg border border-gray-200",children:[(0,n.jsx)("div",{className:"bg-blue-600 text-white py-6 px-6",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"SengarBus"}),(0,n.jsx)("p",{className:"text-blue-100 mt-1",children:"E-Ticket Confirmation"})]}),(0,n.jsx)("div",{className:"bg-white text-blue-800 rounded-full p-3 shadow-md",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})})]})}),(0,n.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,n.jsxs)("div",{className:"flex flex-wrap justify-between items-center",children:[(0,n.jsxs)("div",{className:"mb-2 md:mb-0",children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Booking Reference"}),(0,n.jsxs)("div",{className:"text-xl font-bold text-gray-800",children:["#",e.booking_id]})]}),(0,n.jsxs)("div",{className:"mb-2 md:mb-0",children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Status"}),(0,n.jsx)("div",{className:"inline-block py-1 text-sm font-semibold rounded-ful text-green-800",children:e.payment_status})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Booked On"}),(0,n.jsx)("div",{className:"text-sm text-gray-800",children:new Date(e.booked_at).toLocaleDateString()})]})]})}),(0,n.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Passenger Details"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Name"}),(0,n.jsxs)("div",{className:"text-gray-800",children:[e.user.firstname," ",e.user.lastname]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Contact"}),(0,n.jsx)("div",{className:"text-gray-800",children:e.user.phone})]}),(0,n.jsxs)("div",{className:"md:col-span-2",children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Email"}),(0,n.jsx)("div",{className:"text-gray-800",children:e.user.email})]})]})]}),(0,n.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Journey Details"}),(0,n.jsxs)("div",{className:"flex flex-col md:flex-row justify-between mb-4",children:[(0,n.jsxs)("div",{className:"mb-4 md:mb-0",children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Departure"}),(0,n.jsx)("div",{className:"text-gray-800 font-medium",children:e.schedule.route.source}),(0,n.jsx)("div",{className:"text-gray-800 font-medium",children:v(e.schedule.departure_time)})]}),(0,n.jsx)("div",{className:"hidden md:block self-center",children:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Arrival"}),(0,n.jsx)("div",{className:"text-gray-800 font-medium",children:e.schedule.route.destination}),(0,n.jsx)("div",{className:"text-gray-800 font-medium",children:v(e.schedule.arrival_time)})]})]})]}),(0,n.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Seat Details"}),(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:e.seats.map(e=>(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 border border-blue-100",children:[(0,n.jsxs)("div",{className:"text-xs uppercase text-blue-700 font-semibold",children:["Seat ",e.seat_no]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,n.jsx)("span",{className:"text-gray-800",children:e.seat_type}),(0,n.jsxs)("span",{className:"font-bold text-gray-900",children:["₹",e.price]})]})]},e.seat_id))})]}),(0,n.jsx)("div",{className:"p-6 bg-gray-50",children:(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Total Amount"}),(0,n.jsxs)("div",{className:"text-2xl font-bold text-gray-800",children:["₹",e.amount]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsx)("div",{className:"text-xs uppercase text-gray-500 font-semibold",children:"Payment Status"}),(0,n.jsx)("div",{className:"text-green-600 font-medium",children:e.payment_status})]})]})}),(0,n.jsxs)("div",{className:"bg-gray-100 px-6 py-4 text-center",children:[(0,n.jsx)("p",{className:"text-gray-600 text-sm",children:"Thank you for choosing SengarBus! We wish you a safe and comfortable journey."}),(0,n.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"Have questions? Contact our support at support@sengarbus.com"})]})]})}),(0,n.jsx)(l.$,{onClick:f,disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-md shadow-sm flex items-center",children:c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Download Ticket as PDF"]})})]}):(0,n.jsx)("div",{className:"flex justify-center items-center h-screen bg-gray-50",children:(0,n.jsxs)("div",{className:"animate-pulse flex flex-col items-center",children:[(0,n.jsx)("div",{className:"h-8 w-64 bg-gray-200 rounded mb-4"}),(0,n.jsx)("div",{className:"h-4 w-48 bg-gray-200 rounded"})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[930,316,2,7,441,587,358],()=>t(11692)),_N_E=e.O()}]);