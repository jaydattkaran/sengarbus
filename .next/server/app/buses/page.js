(()=>{var e={};e.id=811,e.ids=[811],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4190:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var r=t(45512),a=t(87021),i=t(58009),l=t(79334);let n=(0,t(41680).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);var d=t(76245);let o=()=>{let{isSignedIn:e}=(0,d.Jd)(),s=(0,l.useSearchParams)(),t=(0,l.useRouter)(),[o]=(0,i.useState)(s.get("source")||""),[c]=(0,i.useState)(s.get("destination")||""),[x,u]=(0,i.useState)([]),[m,p]=(0,i.useState)(!0),h=s.get("date")?new Date(s.get("date")):null,[v]=(0,i.useState)(h),f=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),b=e=>new Date(e).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),g=x.map(e=>({...e,formattedDeparture:f(e.departure_time),formattedArrival:f(e.arrival_time)}));if((0,i.useEffect)(()=>{o&&c&&v&&(async()=>{try{p(!0);let e=await fetch("http://localhost:5000/api/search-buses",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({source:o,destination:c,travelDate:v?v.toISOString().split("T")[0]:null})});if(!e.ok)throw Error("Failed to fetch buses");let s=await e.json();console.log("Available buses:",s);let t=s.buses?.map(e=>{let s=e.available_seats||[];return{...e,totalAvailableSeats:s.filter(e=>"Available"===e.status).length,lowestPrice:s.length>0?Math.min(...s.map(e=>+e.price)):null}})||[];u(t)}catch(e){console.log("Error fetching buses:",e)}finally{p(!1)}})()},[o,c,v]),m)return(0,r.jsx)("p",{children:"Loading buses..."});let j=async s=>{if(s.isFullyBooked){alert("This bus is fully booked.");return}try{if(!e){alert("Please sign in to continue booking.");return}let r=await fetch("http://localhost:5000/api/buses/select",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({bus:s})});if(r.ok){let e=await r.json();console.log("bus details for booking",e),t.push(`/ticket?busId=${s.bus_id}&routeId=${s.route_id}`)}else alert("Bus not selected.")}catch(e){console.log("Error selecting bus:",e),alert("An error occurred. Please try again.")}};return(0,r.jsx)("main",{children:(0,r.jsx)("section",{className:"py-4",children:(0,r.jsx)("div",{className:"p-2",children:(0,r.jsxs)("section",{className:"py-4 md:mx-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-xl px-2",children:["Buses from ",o," to ",c," on"," ",g[0]?.formattedDeparture]}),(0,r.jsx)("ul",{className:"py-2 mt-4 px-1 flex flex-col gap-4 md:hidden block",children:Array.isArray(x)&&x.length>0?x.map(e=>(0,r.jsx)("li",{onClick:()=>j(e),className:"cursor-pointer",children:(0,r.jsxs)("div",{className:"w-[95vw] rounded glass-box border grid md:grid-cols-3 md:gap-1 gap-2 p-1 py-2",children:[(0,r.jsxs)("div",{className:"px-2 flex md:flex-col flex-row justify-between items-center md:gap-4 gap-20",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xl font-semibold",children:e.bus_name}),(0,r.jsx)("div",{className:"text-neutral-400 text-sm",children:e.bus_type})]}),(0,r.jsx)("div",{children:"4.0/5"})]}),(0,r.jsxs)("div",{className:"flex justify-between pb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between gap-2 px-2",children:[(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-xl font-semibold",children:b(e.departure_time)})}),(0,r.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,r.jsxs)("div",{className:"text-neutral-300",children:["- ",e.distance_km," km -"]})}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-xl font-semibold",children:b(e.arrival_time)})})]}),(0,r.jsxs)("div",{className:"px-2 text-sm text-gray-400 flex gap-1",children:[(0,r.jsx)(n,{className:"w-4 h-4"})," ",(0,r.jsxs)("div",{className:"items-center",children:[e.totalAvailableSeats," Seats"]})]})]}),(0,r.jsx)("div",{className:"flex md:flex-col justify-between items-end gap-2 pr-2 md:px-0 px-2",children:(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-xl font-semibold",children:null!==e.lowestPrice&&(0,r.jsxs)("div",{className:"text-xl font-semibold",children:["₹ ",e.lowestPrice]})})})})]})]})},e.schedule_id)):(0,r.jsx)("p",{children:"No buses available"})})]}),(0,r.jsx)("div",{children:(0,r.jsx)("ul",{className:"py-2 mt-4 px-1 flex flex-col gap-4 hidden md:block",children:Array.isArray(x)&&x.length>0?x.map(e=>(0,r.jsx)("li",{children:(0,r.jsxs)("div",{className:"w-full mt-4 rounded glass-box border flex justify-between gap-2 px-2 py-4",children:[(0,r.jsxs)("div",{className:"flex flex-col justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xl font-semibold",children:e.bus_name}),(0,r.jsx)("div",{className:"text-neutral-400 text-sm",children:e.bus_type})]}),(0,r.jsx)("div",{children:"4.0/5"})]}),(0,r.jsxs)("div",{className:"flex justify-between gap-2 min-w-[18vw]",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:f(e.departure_time)}),(0,r.jsx)("div",{className:"text-xl font-semibold",children:b(e.departure_time)}),(0,r.jsx)("div",{className:"text-sm w-[7rem]",children:e.boarding_points?.length>0?(0,r.jsx)("p",{children:e.boarding_points[0].location_name}):(0,r.jsx)("p",{children:"Not available"})})]}),(0,r.jsxs)("div",{className:"flex flex-col items-center pr-4",children:[(0,r.jsxs)("div",{className:"text-neutral-300",children:[e.distance_km," km"]}),(0,r.jsx)("div",{className:"relative flex items-center",children:(0,r.jsxs)("div",{className:"w-[5rem] h-1 bg-neutral-400 relative",children:[(0,r.jsx)("span",{className:"absolute -left-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-neutral-400 rounded-full"}),(0,r.jsx)("span",{className:"absolute -right-2 top-1/2 -translate-y-1/2 w-2 h-2 bg-neutral-400 rounded-full"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm",children:f(e.arrival_time)}),(0,r.jsx)("div",{className:"text-xl font-semibold",children:b(e.arrival_time)}),(0,r.jsx)("div",{className:"text-sm w-[7rem]",children:e.dropping_points?.length>0?(0,r.jsx)("p",{children:e.dropping_points[0].location_name}):(0,r.jsx)("p",{children:"Not available"})})]})]}),(0,r.jsxs)("div",{className:"flex md:flex-col  justify-between items-end gap-2",children:[(0,r.jsx)("div",{children:null!==e.lowestPrice&&(0,r.jsxs)("div",{className:"text-xl font-semibold",children:["₹ ",e.lowestPrice]})}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,r.jsxs)("div",{className:"text-neutral-400 text-sm",children:[e.totalAvailableSeats," Seats"]}),(0,r.jsx)(a.$,{onClick:()=>j(e),className:"uppercase cursor-pointer text-lg w-[11rem] text-white font-semibold bg-[#FF6F00] hover:bg-[#FF6F00]",children:"Select Seat"})]})]})]})},e.schedule_id)):(0,r.jsx)("p",{children:"No buses available"})})})]})})})})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},41680:(e,s,t)=>{"use strict";t.d(s,{A:()=>d});var r=t(58009);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=(...e)=>e.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim();var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,r.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:t=2,absoluteStrokeWidth:a,className:n="",children:d,iconNode:o,...c},x)=>(0,r.createElement)("svg",{ref:x,...l,width:s,height:s,stroke:e,strokeWidth:a?24*Number(t)/Number(s):t,className:i("lucide",n),...c},[...o.map(([e,s])=>(0,r.createElement)(e,s)),...Array.isArray(d)?d:[d]])),d=(e,s)=>{let t=(0,r.forwardRef)(({className:t,...l},d)=>(0,r.createElement)(n,{ref:d,iconNode:s,className:i(`lucide-${a(e)}`,t),...l}));return t.displayName=`${e}`,t}},54083:(e,s,t)=>{Promise.resolve().then(t.bind(t,4190))},54193:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>o});var r=t(70260),a=t(28203),i=t(25155),l=t.n(i),n=t(67292),d={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let o={children:["",{children:["buses",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,88453)),"/home/karan/sengarbus/app/buses/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,638)),"/home/karan/sengarbus/app/layout.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,84717)),"/home/karan/sengarbus/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,88772)),"/home/karan/sengarbus/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/karan/sengarbus/app/buses/page.tsx"],x={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/buses/page",pathname:"/buses",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78059:(e,s,t)=>{Promise.resolve().then(t.bind(t,88453))},79551:e=>{"use strict";e.exports=require("url")},88453:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/karan/sengarbus/app/buses/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/karan/sengarbus/app/buses/page.tsx","default")}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[680,435,246],()=>t(54193));module.exports=r})();