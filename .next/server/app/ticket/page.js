(()=>{var e={};e.id=699,e.ids=[699],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},25409:(e,s,t)=>{"use strict";t.d(s,{p:()=>i});var a=t(45512);t(58009);var r=t(59462);function i({className:e,type:s,...t}){return(0,a.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-12 w-full min-w-0 rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...t})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34891:(e,s,t)=>{Promise.resolve().then(t.bind(t,43245))},40467:(e,s,t)=>{Promise.resolve().then(t.bind(t,69759))},41680:(e,s,t)=>{"use strict";t.d(s,{A:()=>o});var a=t(58009);let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=(...e)=>e.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim();var n={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:l="",children:o,iconNode:d,...c},m)=>(0,a.createElement)("svg",{ref:m,...n,width:s,height:s,stroke:e,strokeWidth:r?24*Number(t)/Number(s):t,className:i("lucide",l),...c},[...d.map(([e,s])=>(0,a.createElement)(e,s)),...Array.isArray(o)?o:[o]])),o=(e,s)=>{let t=(0,a.forwardRef)(({className:t,...n},o)=>(0,a.createElement)(l,{ref:o,iconNode:s,className:i(`lucide-${r(e)}`,t),...n}));return t.displayName=`${e}`,t}},43245:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var a=t(45512),r=t(58009),i=t(76245),n=t(87021),l=t(25409),o=t(79334);let d=(0,t(41680).A)("BusFront",[["path",{d:"M4 6 2 7",key:"1mqr15"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"m22 7-2-1",key:"1umjhc"}],["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}],["path",{d:"M6 19v2",key:"1loha6"}],["path",{d:"M18 21v-2",key:"sqyl04"}]]),c=()=>{let{isSignedIn:e}=(0,i.Jd)(),s=(0,o.useRouter)(),[t,c]=(0,r.useState)(null),[m,x]=(0,r.useState)([]),[p,h]=(0,r.useState)(null),[u,g]=(0,r.useState)(null),[f,v]=(0,r.useState)(null),[b,j]=(0,r.useState)({name:"",email:"",phone:"",age:"",gender:""});(0,r.useEffect)(()=>{e&&(async()=>{try{let e=await fetch("https://sengarbus.onrender.com/api/ticket",{method:"GET",credentials:"include"}),s=await e.json();console.log("bus data from backend:",s),s.userData&&(j({name:`${s.userData.firstname} ${s.userData.lastname}`,email:s.userData.email||"",phone:s.userData.phone.replace(/^\+91\s*/,""),age:s.userData.age||"",gender:s.userData.gender||""}),v(s.userData.gender||"")),e.ok?c(s.bus):console.log("Failed to fetch bus details:",s)}catch(e){console.error("Error fetching bus details:",e)}})()},[e]);let N=e=>{"Booked"!==e.status&&x(s=>s.some(s=>s.seat_no===e.seat_no)?s.filter(s=>s.seat_no!==e.seat_no):[...s,e])},y=async(e,a)=>{if(e.preventDefault(),console.log("\uD83D\uDE80 Schedule ID received in function:",a),!f||!b.age.trim()||!b.email.trim()||!b.name.trim()||!b.phone.trim()){alert("Please fill all fields before submitting.");return}if(!t){alert("Check the details correctly");return}try{let e=m.reduce((e,s)=>e+s.price,0)+20,t=b.phone.startsWith("+")?b.phone:"+91 "+b.phone,[r,...i]=b.name.trim().split(" "),n=i.join(" ")||"",l=await fetch("https://sengarbus.onrender.com/api/bookticket",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({schedule_id:a,seat_id:m,firstname:r,lastname:n,email:b.email,phone:t,age:b.age,gender:b.gender,amount:e})}),o=await l.json();if(console.log("booking data:",o),!l.ok||!o?.booking_id)throw Error(o?.message||"Booking failed. Please try again.");s.push(`/booking-confirmation?booking_id=${o.booking_id}`)}catch(e){console.log("Error initiating payment:",e),alert("Payment failed. Please try again.")}};return(0,a.jsx)("main",{children:e?(0,a.jsxs)("div",{children:[t?(0,a.jsx)("section",{className:" md:px-6 py-4 gap-2 border-b",children:(0,a.jsxs)("div",{className:"border rounded flex flex-col gap-6 py-2 px-4 ",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{children:t.name}),(0,a.jsx)("h3",{children:"Boarding Points"}),t.boarding_points.length>0?(0,a.jsx)("ul",{children:t.boarding_points.map((e,s)=>(0,a.jsxs)("li",{className:"flex gap-1 mt-1 items-center",onClick:()=>h(e),style:{cursor:"pointer",fontWeight:p?.location_name===e.location_name?"bold":"normal",color:p?.location_name===e.location_name?"#f5f5f5":"#a3a3a3"},children:[(0,a.jsx)(d,{className:"w-4 h-4"}),(0,a.jsxs)("div",{children:[e.location_name," - ",e.time.slice(0,5)]})]},s))}):(0,a.jsx)("p",{children:"You will be notified for boarding."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{children:"Dropping Points"}),t.dropping_points.length>0?(0,a.jsx)("ul",{children:t.dropping_points.map((e,s)=>(0,a.jsxs)("li",{className:"flex gap-1 mt-1 items-center",onClick:()=>g(e),style:{cursor:"pointer",fontWeight:u?.location_name===e.location_name?"bold":"normal",color:u?.location_name===e.location_name?"#f5f5f5":"#a3a3a3"},children:[(0,a.jsx)(d,{className:"w-4 h-4"})," ",(0,a.jsxs)("div",{children:[e.location_name," - ",e.time.slice(0,5)]})]},s))}):(0,a.jsx)("p",{children:"You will be notified for dropping."})]})]}),(0,a.jsxs)("div",{className:"px-4 py-4 rounded border shadow-lg  mx-auto",children:[(0,a.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-gray-400 rounded"}),(0,a.jsx)("div",{children:"Booked"})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-[#28A745] rounded"}),(0,a.jsx)("div",{children:"Available"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-4 md:grid-cols-8 gap-4 p-2",children:t?.available_seats&&t.available_seats.length>0?t.available_seats.map(e=>(0,a.jsxs)("button",{className:`w-[4rem] h-[3.5rem] flex flex-col items-center justify-center text-sm font-semibold border-2 rounded-lg 
          ${"Booked"===e.status?"bg-gray-400 text-white cursor-not-allowed":m.some(s=>s.seat_no===e.seat_no)?"bg-blue-500 text-white":"bg-[#28A745] text-white hover:bg-green-600"}`,disabled:"Booked"===e.status,onClick:()=>"Booked"!==e.status&&N(e),children:[(0,a.jsx)("span",{className:"font-bold",children:e.seat_no}),(0,a.jsx)("span",{className:"text-xs",children:e.seat_type})]},e.seat_no)):(0,a.jsx)("p",{className:"text-gray-500 text-center w-full",children:"Fetching seats..."})}),(0,a.jsxs)("div",{className:"flex justify-between mt-6 p-2 border-t",children:[(0,a.jsxs)("div",{children:["Seats Selected:"," ",(0,a.jsx)("span",{className:"text-xl font-semibold",children:m.length>0?m.map(e=>e.seat_no).join(", "):"None"})]}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"text-xl font-semibold",children:["â‚¹"," ",m.reduce((e,s)=>e+s.price,0)]})})]})]})]})}):(0,a.jsx)("p",{children:"Loading route details...."}),t?(0,a.jsx)("section",{className:"flex flex-col items-center justify-center py-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold",children:"Review your booking"}),(0,a.jsxs)("div",{className:"text-xl font-medium",children:[" ",(0,a.jsxs)("span",{className:"font-semibold mr-1",children:[t.source," - ",t.destination," "]})," ","|"," ",new Date(t.departure_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,a.jsx)("div",{className:"md:w-[60%]",children:(0,a.jsxs)("div",{className:"border rounded px-4 pt-2 pb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xl font-semibold",children:t.bus_name}),(0,a.jsx)("div",{className:"text-sm",children:t.bus_type}),(0,a.jsxs)("div",{className:"my-2",children:["Seat selected"," ",(0,a.jsx)("span",{className:"text-xl font-semibold",children:m.length>0?m.map(e=>e.seat_no).join(", "):"None"})]})]}),(0,a.jsx)("div",{className:"text-[#0077B6]",children:"Cancellation Policy"})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 grid-cols-1 gap-2",children:[(0,a.jsxs)("div",{className:"border px-2 py-2 rounded flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"text-xl",children:"Boarding Point"}),(0,a.jsxs)("div",{className:"bg-[#0077B6] text-white px-2 rounded  text-sm",children:[p?`${p.time.slice(0,5)} `:"None"," ",new Date(t.departure_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,a.jsx)("div",{className:"text-lg mt-2",children:p?`${p.location_name}`:"None"})]}),(0,a.jsxs)("div",{className:"border px-2 py-2 rounded flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"text-xl",children:"Dropping Point"}),(0,a.jsxs)("div",{className:"bg-[#0077B6] text-white px-2 rounded text-sm",children:[u?`${u.time.slice(0,5)} `:"None"," ",new Date(t.arrival_time).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),(0,a.jsx)("div",{className:"text-lg mt-2",children:u?`${u.location_name} `:"None"})]})]})]})}),(0,a.jsxs)("div",{className:"border rounded md:w-[40%] flex flex-col gap-2 px-4 py-2",children:[(0,a.jsx)("div",{className:"text-2xl font-semibold",children:"Price Details"}),(0,a.jsxs)("div",{className:"border-b py-1",children:[(0,a.jsxs)("div",{children:["Base Fare :"," ",(0,a.jsxs)("span",{className:"text-xl mx-2 font-semibold",children:["â‚¹"," ",m.reduce((e,s)=>e+s.price,0)]})]}),(0,a.jsxs)("div",{children:["GST & Exlcusive tax :"," ",(0,a.jsx)("span",{className:"text-xl mx-2 font-semibold",children:"â‚¹ 20"})]})]}),(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Total :"," ",(0,a.jsxs)("span",{className:"text-xl mx-2 font-semibold",children:["â‚¹"," ",m.reduce((e,s)=>e+s.price,0)+20]})]})]})]}),(0,a.jsxs)("div",{className:"border rounded p-4 mt-4",children:[(0,a.jsx)("div",{className:"text-2xl",children:"Passenger Details"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-10 gap-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-1",children:"Full Name"}),(0,a.jsx)(l.p,{type:"text",value:b.name,onChange:e=>j({...b,name:e.target.value}),className:"h-10 mt-2 ",placeholder:"Enter your name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-1",children:"Age"}),(0,a.jsx)(l.p,{className:"h-10 mt-2",placeholder:"Age",type:"text",value:b.age,onChange:e=>j({...b,age:e.target.value})})]}),(0,a.jsxs)("div",{className:"mx-1",children:[(0,a.jsx)("div",{children:"Gender"}),(0,a.jsx)("div",{className:"flex gap-2 mt-2",children:["Male","Female"].map(e=>(0,a.jsx)(n.$,{variant:f===e?"destructive":"secondary",onClick:()=>{v(e),j(s=>({...s,gender:e}))},className:`px-4 py-2 rounded-md transition-all ${f===e?"":"border"}`,children:e},e))})]})]})]}),(0,a.jsxs)("div",{className:"border rounded p-4 mt-4",children:[(0,a.jsx)("div",{className:"text-2xl",children:"Contact Details"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:gap-10 gap-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-1",children:"Email"}),(0,a.jsx)(l.p,{className:"h-10 mt-2 ",placeholder:"Enter your email",type:"email",value:b.email,onChange:e=>j({...b,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mx-1",children:"Mobile Number"}),(0,a.jsx)(l.p,{className:"h-10 mt-2 ",placeholder:"Enter your number",type:"text",value:b.phone,onChange:e=>j({...b,phone:e.target.value})})]})]})]}),(0,a.jsxs)(n.$,{onClick:e=>y(e,t.schedule_id),className:"w-full text-xl bg-[#FF6F00] hover:bg-[#FF6F00] text-white cursor-pointer font-semibold h-12 mt-4",children:["Continue to Payment â‚¹"," ",m.reduce((e,s)=>e+s.price,0)+20]})]})}):(0,a.jsx)("p",{children:"Loading ticket details...."})]}):(0,a.jsx)(i.hZ,{mode:"modal"})})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},69759:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/karan/sengarbus/app/ticket/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/karan/sengarbus/app/ticket/page.tsx","default")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},79551:e=>{"use strict";e.exports=require("url")},84109:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>d});var a=t(70260),r=t(28203),i=t(25155),n=t.n(i),l=t(67292),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(s,o);let d={children:["",{children:["ticket",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,69759)),"/home/karan/sengarbus/app/ticket/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,638)),"/home/karan/sengarbus/app/layout.tsx"],loading:[()=>Promise.resolve().then(t.bind(t,84717)),"/home/karan/sengarbus/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,88772)),"/home/karan/sengarbus/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,46055))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/home/karan/sengarbus/app/ticket/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/ticket/page",pathname:"/ticket",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[680,435,827],()=>t(84109));module.exports=a})();